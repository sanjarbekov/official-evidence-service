databaseChangeLog:
  - changeSet:
      id: 013-create-currency
      author: sanjar.bekov
      changes:

        # =========================
        # TABLE: currency
        # =========================
        - createTable:
            tableName: currency
            remarks: "ISO 4217 currency reference data used across valuation and other domains"
            columns:

              # ===== PK =====
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    primaryKeyName: pk_currency
                    nullable: false

              # =========================
              # ISO 4217 CORE
              # =========================
              - column:
                  name: alpha_code
                  type: VARCHAR(3)
                  constraints:
                    nullable: false
                    unique: true

              - column:
                  name: numeric_code
                  type: VARCHAR(3)

              - column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: false

              - column:
                  name: minor_unit
                  type: INTEGER

              # =========================
              # CONTEXT / METADATA
              # =========================
              - column:
                  name: issuing_entity
                  type: VARCHAR(255)

              - column:
                  name: withdrawn
                  type: BOOLEAN

              - column:
                  name: remark
                  type: VARCHAR(1000)

              # =========================
              # VALUATION USAGE
              # =========================
              - column:
                  name: active
                  type: BOOLEAN
                  defaultValueBoolean: true
                  constraints:
                    nullable: false

              - column:
                  name: default_currency
                  type: BOOLEAN
                  defaultValueBoolean: false
                  constraints:
                    nullable: false

              # =========================
              # AuditableEntity
              # =========================
              - column:
                  name: created_date
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP
                  constraints:
                    nullable: false

              - column:
                  name: last_modified_date
                  type: TIMESTAMP
                  defaultValueComputed: CURRENT_TIMESTAMP

              - column:
                  name: created_by
                  type: VARCHAR(255)

              - column:
                  name: last_modified_by
                  type: VARCHAR(255)

        # =========================
        # INDEXES
        # =========================
        - createIndex:
            tableName: currency
            indexName: ix_currency_alpha
            unique: true
            columns:
              - column:
                  name: alpha_code

        - createIndex:
            tableName: currency
            indexName: ix_currency_numeric
            columns:
              - column:
                  name: numeric_code
